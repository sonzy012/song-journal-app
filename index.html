<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4285f4">
    <title>My Journal</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="signInScreen" class="sign-in-screen">
        <div class="sign-in-content">
            <div class="app-icon">üìî</div>
            <h1>My Journals</h1>
            <p>Your personal space for thoughts and memories</p>
            <button id="signInBtn" class="btn-sign-in">Continue with Google</button>
        </div>
    </div>

    <div id="app" style="display:none;">
        <header class="app-header">
            <div class="header-left">
                <h1>Journal</h1>
            </div>
            <div class="header-right">
                <button id="selectBtn" class="btn-text" style="display:none;">Select</button>
                <button id="cancelSelectBtn" class="btn-text" style="display:none;">Cancel</button>
                <button id="deleteSelectedBtn" class="btn-delete" style="display:none;">Delete Selected</button>
                <button id="syncBtn" class="btn-icon" title="Sync from Drive">üîÑ</button>
                <button id="aiChatBtn" class="btn-icon" title="Ask AI">ü§ñ</button>
                <button id="newEntryBtn" class="btn-new">+ New Entry</button>
                <button id="signOutBtn" class="btn-icon">‚ãØ</button>
            </div>
        </header>

        <div class="view-tabs">
            <button id="timelineTab" class="tab-btn active">Timeline</button>
            <button id="calendarTab" class="tab-btn">Calendar</button>
            <button id="locationsTab" class="tab-btn">Locations</button>
            <button id="eventsTab" class="tab-btn">Calendar Events</button>
        </div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="üîç Search entries or tags..." class="search-input">
        </div>

        <div id="timelineView" class="timeline">
            <div class="filters-container">
                <div class="filter-section">
                    <div class="filter-label">üìÖ Date Range</div>
                    <div id="dateFilters" class="filter-buttons">
                        <button id="bookmarkedFilter" class="filter-btn" style="display:none;">‚≠ê Bookmarked</button>
                    </div>
                </div>
                <div class="filter-section" id="tagFilterSection" style="display:none;">
                    <div class="filter-label">üè∑Ô∏è Tags</div>
                    <div id="tagFilters" class="filter-buttons"></div>
                </div>
                <div class="sort-section">
                    <select id="sortEntriesSelect" class="sort-select">
                        <option value="desc">‚Üì Newest First</option>
                        <option value="asc">‚Üë Oldest First</option>
                    </select>
                </div>
            </div>
            <div id="entriesList"></div>
        </div>

        <div id="calendarView" class="calendar-container" style="display:none;">
            <div class="calendar-header">
                <button id="prevMonth" class="btn-icon">‚Äπ</button>
                <h2 id="currentMonth"></h2>
                <button id="todayBtn" class="btn-today">Today</button>
                <button id="nextMonth" class="btn-icon">‚Ä∫</button>
            </div>
            <div id="calendar" class="calendar-grid"></div>
            <div id="dayEntries" class="day-entries"></div>
        </div>



        <div id="locationsView" class="locations-container" style="display:none;">
            <div style="padding:20px;border-bottom:1px solid #e5e5ea;">
                <h2 style="margin:0 0 10px 0;font-size:18px;">Saved Locations</h2>
                <button id="addSavedLocationBtn" class="btn-new">+ Add Location</button>
            </div>
            <div id="savedLocationsList" class="saved-locations-list"></div>
            <div style="padding:20px;border-top:1px solid #e5e5ea;margin-top:20px;">
                <h2 style="margin:0 0 10px 0;font-size:18px;">Location History</h2>
                <div id="locationCategoryFilter" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;"></div>
            </div>
            <div id="locationHistoryList" class="location-history-list"></div>
        </div>

        <div id="eventsView" class="events-container" style="display:none;">
            <div style="padding:20px;display:flex;gap:10px;align-items:center;">
                <select id="calendarSelect" style="padding:10px;border:1px solid #e5e5ea;border-radius:8px;font-size:15px;">
                    <option value="">Loading calendars...</option>
                </select>
                <button id="importEventsBtn" class="btn-new">Import Events</button>
                <select id="sortEventsSelect" style="padding:10px;border:1px solid #e5e5ea;border-radius:8px;font-size:15px;margin-left:auto;">
                    <option value="desc">Newest First</option>
                    <option value="asc">Oldest First</option>
                </select>
            </div>
            <div id="calendarEventsList" class="calendar-events-list"></div>
        </div>



        <div id="editorModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <button id="cancelBtn" class="btn-text">Cancel</button>
                    <button id="saveBtn" class="btn-save">Save</button>
                </div>
                <input type="text" id="entryTitle" placeholder="Title (optional)" class="editor-title">
                <input type="date" id="entryDate" class="editor-date" style="width:100%;padding:12px;border:1px solid #e5e5ea;border-radius:8px;margin-bottom:12px;font-size:15px;">
                <textarea id="entryContent" placeholder="What's on your mind? (optional)" class="editor-content"></textarea>
                <div class="tags-section">
                    <div style="display:flex;gap:8px;position:relative;">
                        <div style="flex:1;position:relative;">
                            <input type="text" id="tagInput" placeholder="Add tags" class="tag-input" onkeydown="handleTagInput(event)" oninput="showTagSuggestions()" onfocus="showTagSuggestions()" style="width:100%;">
                            <div id="tagSuggestions" style="display:none;position:absolute;top:100%;left:0;right:0;background:white;border:1px solid #e5e5ea;border-radius:8px;margin-top:4px;max-height:200px;overflow-y:auto;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,0.1);"></div>
                        </div>
                        <button type="button" onclick="addTagFromInput()" class="btn-text" style="padding:8px 16px;">Add Tag</button>
                    </div>
                    <div id="tagsPreview" class="tags-preview"></div>
                </div>
                <div class="media-toolbar">
                    <input type="file" id="mediaInput" accept="image/*,video/*" multiple style="display:none;">
                    <button id="addMediaBtn" class="btn-media">üì∑ Add Photo/Video</button>
                    <button id="detectLocationBtn" class="btn-media">üéØ Detect Location</button>
                    <button id="addLocationBtn" class="btn-media">üìç Add Location</button>
                    <select id="savedLocationSelect" class="saved-location-select" style="display:none;">
                        <option value="">Select saved location...</option>
                    </select>
                </div>
                <div id="locationPreview" class="location-preview"></div>
                <div id="mediaPreview" class="media-preview"></div>
            </div>
        </div>

        <div id="aiChatModal" class="modal">
            <div class="modal-content" style="max-width:700px;max-height:80vh;display:flex;flex-direction:column;">
                <div class="modal-header">
                    <button id="closeChatBtn" class="btn-text">Close</button>
                    <h3 style="margin:0;">ü§ñ Ask AI</h3>
                    <div style="width:60px;"></div>
                </div>
                <div id="chatMessages" style="flex:1;overflow-y:auto;padding:20px;background:#f9f9f9;"></div>
                <div style="padding:16px;border-top:1px solid #e5e5ea;display:flex;gap:8px;">
                    <input type="text" id="chatInput" placeholder="Ask about your journal..." style="flex:1;padding:12px;border:1px solid #e5e5ea;border-radius:8px;font-size:15px;">
                    <button id="sendChatBtn" class="btn-new">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <script src="config.js"></script>
    <script>
        // Load Maps API with key from config after DOM loads
        window.addEventListener('DOMContentLoaded', () => {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${CONFIG.MAPS_API_KEY}&libraries=places&loading=async`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        });
    </script>
    <script src="app.js"></script>
    <script src="pagination.js"></script>
    <script src="ai-chat.js"></script>
</body>
</html>
